[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "User",
  "enabled": 1,
  "modified": "2024-07-22 15:50:10.289569",
  "module": "Face Recognition Login",
  "name": "Collect Model for Face Recognition",
  "script": "frappe.ui.form.on('User', {\n    refresh: function(frm) {\n        if (!frm.is_new()) {\n\n        \tconst collectmodal = `\n\t            <div class=\"modal fade\" id=\"faceCollectModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n\t              <div class=\"modal-dialog\" role=\"document\">\n\t                <div class=\"modal-content\">\n\t                  <div class=\"modal-header\">\n\t                    <h5 class=\"modal-title\" id=\"exampleModalLabel\">Collecting Face Models, Please wait...</h5>\n\t                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n\t                      <span aria-hidden=\"true\">&times;</span>\n\t                    </button>\n\t                  </div>\n\t                  <div class=\"modal-body\">\n\t                    <img src=\"/assets/face_recognition_login/img/collect_face_models.gif\" alt=\"Loading...\" class=\"img-fluid\">\n\t                    <br>\n\t                    <br>\n\t                    <h4><b>Move your head</b> at different angles for better accuracy</h4>\n\t                  </div>\n\t                </div>\n\t              </div>\n\t            </div>\n\t        `\n\n        \t// Append the collectmodal to body\n        \t$('body').append(collectmodal);\n        \t$('#faceCollectModal .modal-dialog').css('max-width', '50rem');\n\n            frm.add_custom_button(__('Collect Face Model'), function() {\n                // Create a new dialog\n                let dialog = new frappe.ui.Dialog({\n                    title: __('Instructions'),\n                    indicator: 'orange',\n                    fields: [\n                        {\n                            fieldtype: 'HTML',\n                            fieldname: 'instructions_html',\n                            options: `\n                                <div>\n                                    <img src=\"/assets/face_recognition_login/img/instructions.png\" alt=\"Instructions Image\" style=\"width: 100%; height: auto;\">\n                                    <p>After clicking OK, please do the following:</p>\n                                    <ol>\n                                        <li><b>Move your head</b> at different angles for better accuracy.</li>\n                                        <li><b>Stare at the camera</b> until we collect the required models for your face.</li>\n                                        <li>A <b>success message</b> will pop up when finished.</li>\n                                    </ol>\n                                    <p style=\"color: red; font-weight: bold;\">Important: Make sure you follow all the steps carefully to ensure the accuracy of the model.</p>\n                                </div>\n                            `\n                        },\n                        {\n                            fieldtype: 'Check',\n                            fieldname: 'accept_instructions',\n                            label: __('I have read and understood the instructions'),\n                            reqd: 1\n                        }\n                    ],\n                    primary_action_label: __('OK'),\n                    primary_action(values) {\n                        if (values.accept_instructions) {\n\n\t\t\t\t\t        const email = frm.doc.email;\n\t\t\t\t\t        if (!email) {\n\t\t\t\t\t            alert(\"Please enter your email first.\");\n\t\t\t\t\t            return;\n\t\t\t\t\t        }\n\n\t\t\t\t\t        $('#faceCollectModal').modal('show');\n\n\t\t\t\t\t        fetch('/api/method/face_recognition_login.api.collect_face_model', {\n\t\t\t\t\t            method: 'POST',\n\t\t\t\t\t            headers: {\n\t\t\t\t\t                'Content-Type': 'application/json',\n\t\t\t\t\t                'X-Frappe-CSRF-Token': frappe.csrf_token\n\t\t\t\t\t            },\n\t\t\t\t\t            body: JSON.stringify({ user_email: email })\n\t\t\t\t\t        }).then(response => {\n\t\t\t\t\t        \t$('#faceCollectModal').modal('hide');\n\t\t\t\t\t            return response.json();\n\t\t\t\t\t        }).then(data => {\n\t\t\t\t\t        \t$('#faceCollectModal').modal('hide');\n\t\t\t\t\t            if (data.status === \"error\") {\n\t\t\t\t\t                frappe.throw(data.message)\n\t\t\t\t\t            } else {\n\t\t\t\t\t            \tfrappe.msgprint({\n\t\t\t\t\t                    title: __('Success'),\n\t\t\t\t\t                    indicator: 'green',\n\t\t\t\t\t                    message: String(data.message.message)\n\t\t\t\t\t                });\n\t\t\t\t\t            }\n\t\t\t\t\t        }).catch(error => {\n\t\t\t\t\t        \t$('#faceCollectModal').modal('hide');\n\t\t\t\t\t            console.error('Collect Face Model Error:', error);\n\t\t\t\t\t            frappe.throw('An unexpected error occurred. Please try again later.')\n\t\t\t\t\t        });\n\n\n                            dialog.hide();\n                        } else {\n                            frappe.msgprint(__('Please accept the instructions to proceed.'));\n                        }\n                    }\n                });\n\n                // Show the dialog\n                dialog.show();\n            }).addClass('btn-success');\n        }\n    }\n});\n",
  "view": "Form"
 }
]